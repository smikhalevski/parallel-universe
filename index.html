<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>parallel-universe - v3.0.0</title><meta name="description" content="Documentation for parallel-universe - v3.0.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">parallel-universe - v3.0.0</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>parallel-universe - v3.0.0</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#parallel-universe-" id="parallel-universe-" style="color: inherit; text-decoration: none;">
  <h1>parallel-universe <a href="https://github.com/smikhalevski/parallel-universe/actions/workflows/test.yml"><img src="https://github.com/smikhalevski/parallel-universe/actions/workflows/test.yml/badge.svg?branch=master&event=push" alt="build"></a></h1>
</a>
<a href="#readme">
  <img alt="Spaceman" src="./spaceman.png"/>
</a>

<p>The set of async flow control structures and promise utils.</p>
<pre><code class="language-sh"><span class="hl-0">npm </span><span class="hl-1">install</span><span class="hl-0"> </span><span class="hl-1">--save-prod</span><span class="hl-0"> </span><span class="hl-1">parallel-universe</span>
</code></pre>
<p>🚀 <a href="https://smikhalevski.github.io/parallel-universe/">API documentation is available here.</a></p>
<ul>
<li><a href="#pubsub"><code>PubSub</code></a></li>
<li><a href="#asyncqueue"><code>AsyncQueue</code></a><ul>
<li><a href="#acknowledgements">Acknowledgements</a></li>
<li><a href="#blocking-vs-non-blocking-acknowledgements">Blocking vs non-blocking acknowledgements</a></li>
</ul>
</li>
<li><a href="#workpool"><code>WorkPool</code></a></li>
<li><a href="#executor"><code>Executor</code></a></li>
<li><a href="#lock"><code>Lock</code></a></li>
<li><a href="#blocker"><code>Blocker</code></a></li>
<li><a href="#untiltruthy"><code>untilTruthy</code></a></li>
<li><a href="#repeatuntil"><code>repeatUntil</code></a></li>
<li><a href="#sleep"><code>sleep</code></a></li>
<li><a href="#racetimeout"><code>raceTimeout</code></a></li>
</ul>

<a href="#pubsub" id="pubsub" style="color: inherit; text-decoration: none;">
  <h1><code>PubSub</code></h1>
</a>
<p>Publish–subscribe pattern implementation that guarantees that published messages are delivered even if some listeners
throw an error.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">pubSub</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">PubSub</span><span class="hl-0">&lt;</span><span class="hl-5">string</span><span class="hl-0">&gt;();</span><br/><br/><span class="hl-6">pubSub</span><span class="hl-0">.</span><span class="hl-4">subscribe</span><span class="hl-0">(</span><span class="hl-6">message</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-6">message</span><span class="hl-0"> === </span><span class="hl-1">&#39;Pluto&#39;</span><span class="hl-0"> </span><span class="hl-7">// ⮕ true</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-6">pubSub</span><span class="hl-0">.</span><span class="hl-4">publish</span><span class="hl-0">(</span><span class="hl-1">&#39;Pluto&#39;</span><span class="hl-0">);</span>
</code></pre>
<p>If listener throws an error, it is passed to an error handler callback:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">pubSub</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">PubSub</span><span class="hl-0">&lt;</span><span class="hl-5">string</span><span class="hl-0">&gt;(</span><span class="hl-6">error</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-6">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">error</span><span class="hl-0">);</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-6">pubSub</span><span class="hl-0">.</span><span class="hl-4">subscribe</span><span class="hl-0">(() </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-8">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">Error</span><span class="hl-0">(</span><span class="hl-1">&#39;Kaput&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-6">pubSub</span><span class="hl-0">.</span><span class="hl-4">publish</span><span class="hl-0">(</span><span class="hl-1">&#39;Mars&#39;</span><span class="hl-0">);</span><br/><span class="hl-7">// Prints &#39;Error: Kaput&#39; to the console</span>
</code></pre>
<p>By default, error handler is set to <code>PubSub.defaultErrorHandler</code> which logs errors to the console.</p>

<a href="#asyncqueue" id="asyncqueue" style="color: inherit; text-decoration: none;">
  <h1><code>AsyncQueue</code></h1>
</a>
<p>Asynchronous queue decouples value providers and value consumers.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">queue</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">AsyncQueue</span><span class="hl-0">();</span><br/><br/><span class="hl-7">// Provider adds a value</span><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-1">&#39;Mars&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-7">// Consumer takes a value</span><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">take</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;&#39;Mars&#39;&gt;</span>
</code></pre>
<p><code>add</code> appends the value to the queue, while <code>take</code> removes the value from the queue as soon as it is available. If there
are no values in the queue upon <code>take</code> call then the returned promise is resolved after the next <code>add</code> call.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">queue</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">AsyncQueue</span><span class="hl-0">();</span><br/><br/><span class="hl-7">// The returned promise would be resolved after the add call</span><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">take</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;&#39;Mars&#39;&gt;</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-1">&#39;Mars&#39;</span><span class="hl-0">);</span>
</code></pre>
<p>Consumers receive values from the queue in the same order they were added by providers:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">queue</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">AsyncQueue</span><span class="hl-0">();</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-1">&#39;Mars&#39;</span><span class="hl-0">);</span><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-1">&#39;Venus&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">take</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;&#39;Mars&#39;&gt;</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">take</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;&#39;Venus&#39;&gt;</span>
</code></pre>

<a href="#acknowledgements" id="acknowledgements" style="color: inherit; text-decoration: none;">
  <h2>Acknowledgements</h2>
</a>
<p>In some cases removing the value from the queue isn&#39;t the desirable behavior, since the consumer may not be able to
process the taken value. Use <code>takeAck</code> to examine available value and acknowledge that it can be processed.</p>
<pre><code class="language-ts"><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">takeAck</span><span class="hl-0">().</span><span class="hl-4">then</span><span class="hl-0">(([</span><span class="hl-6">value</span><span class="hl-0">, </span><span class="hl-6">ack</span><span class="hl-0">]) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-8">if</span><span class="hl-0"> (</span><span class="hl-4">doSomeChecks</span><span class="hl-0">()) {</span><br/><span class="hl-0">    </span><span class="hl-4">ack</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-4">doSomething</span><span class="hl-0">(</span><span class="hl-6">value</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">});</span>
</code></pre>
<p><code>takeAck</code> returns a tuple of the available value and the acknowledgement callback. The consumer should call <code>ack</code> to
notify the queue on weather to remove the value from the queue or to retain it.</p>
<p>To acknowledge that the consumer can process the value, and the value must be removed from the queue use:</p>
<pre><code class="language-ts"><span class="hl-4">ack</span><span class="hl-0">();</span><br/><span class="hl-7">// or ack(true)</span>
</code></pre>
<p>To acknowledge that the value should be retained by the queue use:</p>
<pre><code class="language-ts"><span class="hl-4">ack</span><span class="hl-0">(</span><span class="hl-2">false</span><span class="hl-0">);</span>
</code></pre>
<p>The value that was retained in the queue becomes available for the subsequent consumer.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">queue</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">AsyncQueue</span><span class="hl-0">();</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-1">&#39;Pluto&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">takeAck</span><span class="hl-0">(([</span><span class="hl-6">value</span><span class="hl-0">, </span><span class="hl-6">ack</span><span class="hl-0">]) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">ack</span><span class="hl-0">(</span><span class="hl-2">false</span><span class="hl-0">); </span><span class="hl-7">// Tells queue to retain the value</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">take</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;&#39;Pluto&#39;&gt;</span>
</code></pre>

<a href="#blocking-vs-non-blocking-acknowledgements" id="blocking-vs-non-blocking-acknowledgements" style="color: inherit; text-decoration: none;">
  <h2>Blocking vs non-blocking acknowledgements</h2>
</a>
<p>If you didn&#39;t call <code>ack</code>, the acknowledgement would be automatically revoked on <em>the next tick</em> after the promise
returned by <code>takeAck</code> is resolved, and the value would remain in the queue.</p>
<p>If acknowledgement was revoked, the <code>ack</code> call would throw an error:</p>
<pre><code class="language-ts"><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">takeAck</span><span class="hl-0">()</span><br/><span class="hl-0">  .</span><span class="hl-4">then</span><span class="hl-0">(</span><span class="hl-6">protocol</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-6">protocol</span><span class="hl-0">) </span><span class="hl-7">// Add an extra tick</span><br/><span class="hl-0">  .</span><span class="hl-4">then</span><span class="hl-0">(([</span><span class="hl-6">value</span><span class="hl-0">, </span><span class="hl-6">ack</span><span class="hl-0">]) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">ack</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-7">// ❌ Error: AsyncQueue acknowledgement was revoked</span><br/><span class="hl-0">  });</span>
</code></pre>
<p>To prevent the acknowledgement from being revoked, request a blocking acknowledgement:</p>
<pre><code class="language-ts"><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">takeBlockingAck</span><span class="hl-0">()</span><br/><span class="hl-0">  .</span><span class="hl-4">then</span><span class="hl-0">(</span><span class="hl-6">protocol</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-6">protocol</span><span class="hl-0">) </span><span class="hl-7">// Add an extra tick</span><br/><span class="hl-0">  .</span><span class="hl-4">then</span><span class="hl-0">(([</span><span class="hl-6">value</span><span class="hl-0">, </span><span class="hl-6">ack</span><span class="hl-0">]) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">ack</span><span class="hl-0">(); </span><span class="hl-7">// Value successfully acknowledged</span><br/><span class="hl-0">    </span><span class="hl-4">doSomething</span><span class="hl-0">(</span><span class="hl-6">value</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span>
</code></pre>
<p>Blocking acknowledgement is required if the consumer has to perform asynchronous actions <em>before</em> processing the value.</p>
<p>To guarantee that consumers receive values in the same order as they were provided, blocking acknowledgements prevent
subsequent consumers from being resolved until <code>ack</code> is called. Be sure to call <code>ack</code> to prevent the queue from being
stuck indefinitely.</p>
<pre><code class="language-ts"><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-2">function</span><span class="hl-0"> </span><span class="hl-4">blockingConsumer</span><span class="hl-0">() {</span><br/><span class="hl-0">  </span><span class="hl-2">const</span><span class="hl-0"> [</span><span class="hl-3">value</span><span class="hl-0">, </span><span class="hl-3">ack</span><span class="hl-0">] = </span><span class="hl-6">queue</span><span class="hl-0">.</span><span class="hl-4">takeAck</span><span class="hl-0">(</span><span class="hl-2">true</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  </span><span class="hl-8">try</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">if</span><span class="hl-0"> (</span><span class="hl-8">await</span><span class="hl-0"> </span><span class="hl-4">doSomeChecks</span><span class="hl-0">()) {</span><br/><span class="hl-0">      </span><span class="hl-4">ack</span><span class="hl-0">(</span><span class="hl-2">true</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-4">doSomething</span><span class="hl-0">(</span><span class="hl-6">value</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  } </span><span class="hl-8">finally</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-7">// It&#39;s safe to call ack multiple times since it&#39;s a no-op</span><br/><span class="hl-0">    </span><span class="hl-4">ack</span><span class="hl-0">(</span><span class="hl-2">false</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#workpool" id="workpool" style="color: inherit; text-decoration: none;">
  <h1><code>WorkPool</code></h1>
</a>
<p>The callback execution pool that executes the limited number of callbacks in parallel while other submitted callbacks
wait in the queue.</p>
<pre><code class="language-ts"><span class="hl-7">// The pool that processes 5 callbacks in parallel at maximum</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">pool</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">WorkPool</span><span class="hl-0">(</span><span class="hl-9">5</span><span class="hl-0">);</span><br/><br/><span class="hl-6">pool</span><span class="hl-0">.</span><span class="hl-4">submit</span><span class="hl-0">(</span><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-6">signal</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">());</span><br/><span class="hl-7">// ⮕ Promise&lt;ReturnType&lt;typeof doSomething&gt;&gt;</span>
</code></pre>
<p>You can change how many callbacks can the pool process in parallel:</p>
<pre><code class="language-ts"><span class="hl-6">pool</span><span class="hl-0">.</span><span class="hl-4">resize</span><span class="hl-0">(</span><span class="hl-9">2</span><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;void&gt;</span>
</code></pre>
<p><code>resize</code> returns the promise that is resolved when there are no excessive callbacks being processed in parallel.</p>
<p>If you resize the pool down, callbacks that are pending and exceed the new size limit, are notified via <code>signal</code> that
they must be aborted.</p>
<p>To abort all callbacks that are being processed by the pool and wait for their completion use:</p>
<pre><code class="language-ts"><span class="hl-7">// Resolved when all pending callbacks are fulfilled</span><br/><span class="hl-6">pool</span><span class="hl-0">.</span><span class="hl-4">resize</span><span class="hl-0">(</span><span class="hl-9">0</span><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;void&gt;</span>
</code></pre>

<a href="#executor" id="executor" style="color: inherit; text-decoration: none;">
  <h1><code>Executor</code></h1>
</a>
<p>Executor manages an async callback execution process and provides ways to access execution results, abort or replace an
execution, and subscribe to its state changes.</p>
<p>Create an <code>Executor</code> instance and submit a callback for execution:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">executor</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">Executor</span><span class="hl-0">();</span><br/><br/><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">execute</span><span class="hl-0">(</span><span class="hl-6">doSomething</span><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;void&gt;</span>
</code></pre>
<p>The <code>execute</code> method returns a promise that is fulfilled when the promise returned from the callback is settled.</p>
<p>If there&#39;s a pending execution, it is aborted and the new execution is started.</p>
<p>To check that executor is currently executing a callback check
<a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#pending"><code>pending</code></a>.</p>
<p>After a promise returned from the executed callback is settled, the execution result and rejection reason are available
via <a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#result"><code>result</code></a> and
<a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#reason"><code>reason</code></a>.</p>
<p>You can check whether the promise was
<a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#fulfilled"><code>fulfilled</code></a>,
<a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#rejected"><code>rejected</code></a> or
<a href="https://smikhalevski.github.io/parallel-universe/classes/Executor.html#settled"><code>settled</code></a>.</p>
<p>To abort the pending execution, you can use
an <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal">abort signal</a>
passed to the executed callback:</p>
<pre><code class="language-ts"><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">execute</span><span class="hl-0">(</span><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-6">signal</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-7">// Check signal.aborted</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">abort</span><span class="hl-0">();</span>
</code></pre>
<p>When execution is aborted the current <code>result</code> and <code>reason</code> remain intact.</p>
<p>To reset the executor to the initial state use:</p>
<pre><code class="language-ts"><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">clear</span><span class="hl-0">();</span>
</code></pre>
<p>You can directly fulfill or reject an executor:</p>
<pre><code class="language-ts"><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">resolve</span><span class="hl-0">(</span><span class="hl-6">value</span><span class="hl-0">);</span><br/><br/><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">reject</span><span class="hl-0">(</span><span class="hl-6">reason</span><span class="hl-0">);</span>
</code></pre>
<p>Subscribe to an executor to receive notifications when its state changes:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">unsubscribe</span><span class="hl-0"> = </span><span class="hl-6">executor</span><span class="hl-0">.</span><span class="hl-4">subscribe</span><span class="hl-0">(() </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-7">// Handle the update</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-4">unsubscribe</span><span class="hl-0">();</span>
</code></pre>

<a href="#lock" id="lock" style="color: inherit; text-decoration: none;">
  <h1><code>Lock</code></h1>
</a>
<p>Promise-based <a href="https://en.wikipedia.org/wiki/Lock_(computer_science)">lock implementation</a>.</p>
<p>When someone tries to acquire a <code>Lock</code> they receive a promise for a release callback that is resolved as soon as
previous lock owner invokes their release callback.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">lock</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">Lock</span><span class="hl-0">();</span><br/><br/><span class="hl-6">lock</span><span class="hl-0">.</span><span class="hl-4">acquire</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;() =&gt; void&gt;</span>
</code></pre>
<p>You can check that the lock is <a href="https://smikhalevski.github.io/parallel-universe/classes/Lock.html#locked"><code>locked</code></a>
before acquiring a lock.</p>
<p>For example, if you want to force an async callback executions to be sequential you can use ane external lock:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">lock</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">Lock</span><span class="hl-0">();</span><br/><br/><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-2">function</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">() {</span><br/><span class="hl-0">  </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">release</span><span class="hl-0"> = </span><span class="hl-8">await</span><span class="hl-0"> </span><span class="hl-6">lock</span><span class="hl-0">.</span><span class="hl-4">acquire</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-8">try</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-7">// Long process is handled here</span><br/><span class="hl-0">  } </span><span class="hl-8">finally</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">release</span><span class="hl-0">();</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-7">// Long process would be executed three times sequentially</span><br/><span class="hl-4">doSomething</span><span class="hl-0">();</span><br/><span class="hl-4">doSomething</span><span class="hl-0">();</span><br/><span class="hl-4">doSomething</span><span class="hl-0">();</span>
</code></pre>

<a href="#blocker" id="blocker" style="color: inherit; text-decoration: none;">
  <h1><code>Blocker</code></h1>
</a>
<p>Provides a mechanism for blocking an async process and unblocking it from the outside.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">blocker</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">Blocker</span><span class="hl-0">&lt;</span><span class="hl-5">string</span><span class="hl-0">&gt;();</span><br/><br/><span class="hl-6">blocker</span><span class="hl-0">.</span><span class="hl-4">block</span><span class="hl-0">();</span><br/><span class="hl-7">// ⮕ Promise&lt;string&gt;</span>
</code></pre>
<p>You can later unblock it passing a value that would fulfill the promise returned from the <code>block</code> call:</p>
<pre><code class="language-ts"><span class="hl-6">blocker</span><span class="hl-0">.</span><span class="hl-4">unblock</span><span class="hl-0">(</span><span class="hl-1">&#39;Mars&#39;</span><span class="hl-0">);</span>
</code></pre>

<a href="#untiltruthy" id="untiltruthy" style="color: inherit; text-decoration: none;">
  <h1><code>untilTruthy</code></h1>
</a>
<p>Returns a promise that is fulfilled when a callback returns a truthy value, or a promise that is fulfilled with a
truthy value.</p>
<pre><code class="language-ts"><span class="hl-4">untilTruthy</span><span class="hl-0">(</span><span class="hl-2">async</span><span class="hl-0"> () </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">());</span><br/><span class="hl-7">// ⮕ Promise&lt;ReturnType&lt;typeof doSomething&gt;&gt;</span>
</code></pre>
<p>If you don&#39;t want <code>untilTruthy</code> to invoke the callback too frequently, provide a delay in milliseconds:</p>
<pre><code class="language-ts"><span class="hl-4">untilTruthy</span><span class="hl-0">(</span><span class="hl-6">doSomething</span><span class="hl-0">, </span><span class="hl-9">1_000</span><span class="hl-0">);</span>
</code></pre>
<p>Instead of a fixed delay you can pass a function that returns a delay:</p>
<pre><code class="language-ts"><span class="hl-4">untilTruthy</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-6">doSomething</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-6">result</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-6">result</span><span class="hl-0">.</span><span class="hl-6">rejected</span><span class="hl-0"> ? </span><span class="hl-9">1_000</span><span class="hl-0"> : </span><span class="hl-9">0</span><br/><span class="hl-0">);</span>
</code></pre>

<a href="#repeatuntil" id="repeatuntil" style="color: inherit; text-decoration: none;">
  <h1><code>repeatUntil</code></h1>
</a>
<p>Much like a <a href="#untiltruthy"><code>untilTruthy</code></a> and provides more control when the callback polling is fulfilled.</p>
<pre><code class="language-ts"><span class="hl-4">repeatUntil</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-7">// The callback that is invoked repeatedly</span><br/><span class="hl-0">  </span><span class="hl-2">async</span><span class="hl-0"> () </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">(),</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// The until clause must return a truthy value to stop the loop</span><br/><span class="hl-0">  </span><span class="hl-6">result</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-6">result</span><span class="hl-0">.</span><span class="hl-6">fulfilled</span><span class="hl-0">,</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// Optional delay between callback invokations</span><br/><span class="hl-0">  </span><span class="hl-6">result</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-9">100</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-7">// or just pass a literal number of milliseconds</span><br/><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;ReturnType&lt;typeof doSomething&gt;&gt;</span>
</code></pre>
<p>You can combine <code>repeatUntil</code> with <a href="#racetimeout"><code>raceTimeout</code></a> to limit the repeat duration:</p>
<pre><code class="language-ts"><span class="hl-4">raceTimeout</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-6">signal</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><br/><span class="hl-0">    </span><span class="hl-4">repeatUntil</span><span class="hl-0">(</span><br/><span class="hl-0">      () </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">(),</span><br/><span class="hl-0">      </span><span class="hl-6">result</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-6">signal</span><span class="hl-0">.</span><span class="hl-6">aborted</span><span class="hl-0"> || </span><span class="hl-6">result</span><span class="hl-0">.</span><span class="hl-6">fulfilled</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-9">100</span><br/><span class="hl-0">    ),</span><br/><span class="hl-0">  </span><span class="hl-9">5000</span><br/><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;ReturnType&lt;typeof doSomething&gt;&gt;</span>
</code></pre>

<a href="#sleep" id="sleep" style="color: inherit; text-decoration: none;">
  <h1><code>sleep</code></h1>
</a>
<p>Returns a promise that resolves after a timeout. If signal is aborted then the returned promise is rejected with an
<code>AbortError</code>.</p>
<pre><code class="language-ts"><span class="hl-4">sleep</span><span class="hl-0">(</span><span class="hl-9">100</span><span class="hl-0">, </span><span class="hl-6">abortController</span><span class="hl-0">.</span><span class="hl-6">signal</span><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;void&gt;</span>
</code></pre>

<a href="#racetimeout" id="racetimeout" style="color: inherit; text-decoration: none;">
  <h1><code>raceTimeout</code></h1>
</a>
<p>Rejects with a <code>TimeoutError</code> if execution time exceeds the timeout.</p>
<pre><code class="language-ts"><span class="hl-4">raceTimeout</span><span class="hl-0">(</span><span class="hl-2">async</span><span class="hl-0"> () </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-4">doSomething</span><span class="hl-0">(), </span><span class="hl-9">100</span><span class="hl-0">);</span><br/><span class="hl-7">// ⮕ Promise&lt;ReturnType&lt;typeof doSomething&gt;&gt;</span>
</code></pre>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">parallel-<wbr/>universe -<wbr/> v3.0.0</a>
<ul></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-class"><a href="classes/AsyncQueue.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-class)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-128-path"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)" id="icon-128-text"></path></svg>Async<wbr/>Queue</a></li>
<li class="tsd-kind-class"><a href="classes/Blocker.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Blocker</a></li>
<li class="tsd-kind-class"><a href="classes/Executor.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Executor</a></li>
<li class="tsd-kind-class"><a href="classes/Lock.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Lock</a></li>
<li class="tsd-kind-class"><a href="classes/PubSub.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Pub<wbr/>Sub</a></li>
<li class="tsd-kind-class"><a href="classes/WorkPool.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-128-path"></use><use href="#icon-128-text"></use></svg>Work<wbr/>Pool</a></li>
<li class="tsd-kind-interface"><a href="interfaces/AsyncResult.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-256-path"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)" id="icon-256-text"></path></svg>Async<wbr/>Result</a></li>
<li class="tsd-kind-interface"><a href="interfaces/Execution.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-256-path"></use><use href="#icon-256-text"></use></svg>Execution</a></li>
<li class="tsd-kind-type-alias"><a href="types/AckProtocol.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4194304-path"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)" id="icon-4194304-text"></path></svg>Ack<wbr/>Protocol</a></li>
<li class="tsd-kind-type-alias"><a href="types/Awaitable.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Awaitable</a></li>
<li class="tsd-kind-type-alias"><a href="types/ExecutorCallback.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Executor<wbr/>Callback</a></li>
<li class="tsd-kind-function"><a href="functions/isPromiseLike.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg>is<wbr/>Promise<wbr/>Like</a></li>
<li class="tsd-kind-function"><a href="functions/raceTimeout.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>race<wbr/>Timeout</a></li>
<li class="tsd-kind-function"><a href="functions/repeatUntil.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>repeat<wbr/>Until</a></li>
<li class="tsd-kind-function"><a href="functions/sleep.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>sleep</a></li>
<li class="tsd-kind-function"><a href="functions/toPromise.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>to<wbr/>Promise</a></li>
<li class="tsd-kind-function"><a href="functions/untilTruthy.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>until<wbr/>Truthy</a></li></ul></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>